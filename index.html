<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clarence Yeung · Portfolio</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Layout Wrapper -->
    <main class="page">
      <!-- Visual Placeholder Column -->
      <section class="visual-column" aria-labelledby="visual-title">
        <div class="visual-container" role="presentation">
          <div class="visual-placeholder" aria-hidden="true">
            <canvas id="globe-canvas"></canvas>
          </div>
          <p id="visual-title" class="visual-caption">Globe of journeys</p>
        </div>
      </section>

      <!-- Content Column -->
      <section class="content-column">
        <header class="page-header">
          <div class="header-inner">
            <div class="hero-portrait" aria-hidden="true">
              <span>Portrait</span>
            </div>
            <h1>Clarence Yeung</h1>
          </div>
        </header>

        <!-- About Section -->
        <section class="content-section" id="about">
          <h2>About Me</h2>
          <nav aria-label="Primary links" class="about-links">
            <a href="https://www.linkedin.com" target="_blank" rel="noopener">LinkedIn</a>
            <span aria-hidden="true">·</span>
            <a href="https://scholar.google.com" target="_blank" rel="noopener">Google Scholar</a>
            <span aria-hidden="true">·</span>
            <a href="https://github.com" target="_blank" rel="noopener">GitHub</a>
          </nav>
        </section>

        <!-- Projects Section -->
        <section class="content-section" id="projects">
          <h2>Projects</h2>
          <ul class="project-list">
            <li>
              <h3>Motion Atlas</h3>
              <p>
                A generative study that maps cycling telemetry into kinetic sculptures, pairing
                physics with visual storytelling.
              </p>
            </li>
            <li>
              <h3>Helix Studio</h3>
              <p>
                Interactive DNA narratives that invite visitors to manipulate molecular forms through
                touch and gesture.
              </p>
            </li>
            <li>
              <h3>Living Recipes</h3>
              <p>
                Culinary experiments documented as responsive micro-sites, highlighting craft and
                sensory memory.
              </p>
            </li>
          </ul>
        </section>

        <!-- Contact Section -->
        <section class="content-section" id="contact">
          <h2>Contact</h2>
          <p>
            Reach out for collaborations, research inquiries, or to swap ride routes:
            <a href="mailto:hello@clarenceyeung.com">hello@clarenceyeung.com</a>
          </p>
          <p class="contact-links">
            <a href="https://www.linkedin.com" target="_blank" rel="noopener">LinkedIn</a>
            <span aria-hidden="true">·</span>
            <a href="https://github.com" target="_blank" rel="noopener">GitHub</a>
            <span aria-hidden="true">·</span>
            <a href="https://scholar.google.com" target="_blank" rel="noopener">Google Scholar</a>
            <span aria-hidden="true">·</span>
            <a href="https://clarenceyeung.substack.com" target="_blank" rel="noopener">Substack</a>
          </p>
        </section>
      </section>
    </main>

    <script type="module">
      import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.158/build/three.module.js';
      import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.158/examples/jsm/controls/OrbitControls.js';
      import { feature } from 'https://cdn.jsdelivr.net/npm/topojson-client@3/+esm';

      const canvas = document.getElementById('globe-canvas');
      const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.setClearColor(0x000000, 0);
      renderer.outputColorSpace = THREE.SRGBColorSpace;

      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(42, 1, 0.1, 100);
      camera.position.set(0, 0, 7);

      const ambientLight = new THREE.AmbientLight(0x3a4b68, 0.55);
      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.85);
      directionalLight.position.set(5, 3, 5);
      scene.add(ambientLight, directionalLight);

      const globeGroup = new THREE.Group();
      scene.add(globeGroup);

      const globeRadius = 2.4;
      const globeSurface = new THREE.Mesh(
        new THREE.SphereGeometry(globeRadius, 96, 96),
        new THREE.MeshPhongMaterial({
          color: 0x0a1120,
          emissive: 0x04060c,
          shininess: 22,
          transparent: true,
          opacity: 0.92,
        })
      );
      globeGroup.add(globeSurface);

      const controls = new OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.08;
      controls.enablePan = false;
      controls.rotateSpeed = 0.35;
      controls.zoomSpeed = 0.6;
      controls.minDistance = globeRadius + 1.25;
      controls.maxDistance = globeRadius + 5;

      const outlineMaterial = new THREE.LineBasicMaterial({
        color: new THREE.Color('white'),
        transparent: true,
        opacity: 0.38,
      });

      const glowMaterial = new THREE.PointsMaterial({
        color: 0x8baaff,
        size: 0.08,
        sizeAttenuation: true,
        transparent: true,
        opacity: 0.92,
        blending: THREE.AdditiveBlending,
        depthWrite: false,
      });

      const fallbackActivities = [
        { coordinates: [22.3193, 114.1694], name: 'Hong Kong Ride' },
        { coordinates: [37.7749, -122.4194], name: 'San Francisco Run' },
        { coordinates: [48.8566, 2.3522], name: 'Paris Ride' },
        { coordinates: [59.9139, 10.7522], name: 'Oslo Loop' },
        { coordinates: [35.6762, 139.6503], name: 'Tokyo Tempo' },
        { coordinates: [-33.4489, -70.6693], name: 'Santiago Spin' },
      ];

      const globeContainer = canvas.parentElement;

      function latLonToVector3(lat, lon, radius) {
        // Map latitude/longitude into spherical coordinates and then 3D Cartesian space on the sphere surface.
        const phi = THREE.MathUtils.degToRad(90 - lat);
        const theta = THREE.MathUtils.degToRad(lon + 180);
        const x = radius * Math.sin(phi) * Math.cos(theta);
        const y = radius * Math.cos(phi);
        const z = radius * Math.sin(phi) * Math.sin(theta);
        return new THREE.Vector3(x, y, z);
      }

      async function buildCountryOutlines() {
        // Fetch the TopoJSON world atlas and convert into GeoJSON feature collections for each country outline.
        const response = await fetch('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json');
        const topoJson = await response.json();
        const countries = feature(topoJson, topoJson.objects.countries);

        const addRing = (ring) => {
          // Convert each TopoJSON ring into a Three.js line geometry to render a thin outline around the globe.
          const vertices = ring.map(([lon, lat]) => latLonToVector3(lat, lon, globeRadius + 0.003));
          if (vertices.length < 2) return;
          const geometry = new THREE.BufferGeometry().setFromPoints(vertices);
          globeGroup.add(new THREE.LineLoop(geometry, outlineMaterial));
        };

        countries.features.forEach((country) => {
          if (!country.geometry) return;
          if (country.geometry.type === 'Polygon') {
            country.geometry.coordinates.forEach(addRing);
          } else if (country.geometry.type === 'MultiPolygon') {
            country.geometry.coordinates.forEach((polygon) => polygon.forEach(addRing));
          }
        });
      }

      async function addActivityPoints() {
        let activities = fallbackActivities;
        try {
          const response = await fetch('assets/activities.json');
          if (!response.ok) throw new Error('Unable to load activities.json');
          const data = await response.json();
          if (Array.isArray(data.activities) && data.activities.length) {
            activities = data.activities.map((activity) => ({
              coordinates: activity.coordinates,
              name: activity.name,
            }));
          }
        } catch (error) {
          console.warn('Using fallback activity data for globe markers.', error);
        }

        // To customise data points for other narratives (recipes, events, locations), update assets/activities.json with new latitude/longitude pairs or swap in your own dataset here.
        const positions = new Float32Array(activities.length * 3);
        activities.forEach((activity, index) => {
          const point = latLonToVector3(activity.coordinates[0], activity.coordinates[1], globeRadius + 0.06);
          positions.set(point.toArray(), index * 3);
        });

        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const glowingPoints = new THREE.Points(geometry, glowMaterial);
        globeGroup.add(glowingPoints);
      }

      function handleResize() {
        const { clientWidth, clientHeight } = globeContainer;
        renderer.setSize(clientWidth, clientHeight, false);
        camera.aspect = clientWidth / clientHeight || 1;
        camera.updateProjectionMatrix();
      }

      function animate() {
        requestAnimationFrame(animate);
        globeGroup.rotation.y += 0.0004;
        controls.update();
        renderer.render(scene, camera);
      }

      handleResize();
      window.addEventListener('resize', handleResize);
      buildCountryOutlines().catch((error) => console.error('Unable to draw country outlines.', error));
      addActivityPoints();
      animate();
    </script>
  </body>
</html>
